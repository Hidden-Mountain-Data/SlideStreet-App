// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

enum Roles {
  SUPER_ADMIN
  ADMIN
  USER
}

model DataUsages {
  dataUsageId Int       @id @default(autoincrement()) @map("data_usage_id")
  dateId      Int       @map("date_id")
  routerId    Int       @map("router_id")
  userId      Int       @map("user_id")
  dataUsage   BigInt    @map("data_usage")
  date        Dates     @relation("DataUsageDate", fields: [dateId], references: [dateId])
  router      Routers   @relation("DataUsageRouter", fields: [routerId], references: [routerId])
  user        Users     @relation("DataUsageUser", fields: [userId], references: [userId])
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  @@index([dateId])
  @@index([routerId])
  @@index([userId])
  @@map("data_usages")
}

model Dates {
  dateId           Int          @id @map("date_id")
  date             DateTime     @unique
  day              Int
  dayOfWeek        Int          @map("day_of_week")
  dayOfYear        Int          @map("day_of_year")
  weekOfYear       Int          @map("week_of_year")
  month            Int
  quarter          Int
  year             Int
  dataUsageEntries DataUsages[] @relation("DataUsageDate")
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")

  @@index([date])
  @@map("dates")
}

model Routers {
  routerId         Int               @id @default(autoincrement()) @map("router_id")
  userId           Int               @unique @map("user_id")
  routerIpAddress  String?           @map("router_ip") @db.VarChar(50)
  name             String?           @db.VarChar(200)
  imei             String            @db.VarChar(50)
  sim              String            @db.VarChar(50)
  notes            String?           @db.VarChar(500)
  iccid            String            @db.VarChar(200)
  user             Users             @relation("UserRouter", fields: [userId], references: [userId])
  dataUsageEntries DataUsages[]      @relation("DataUsageRouter")
  routerLocation   RouterLocations[]
  active           Boolean?
  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")
  deletedAt        DateTime?         @map("deleted_at")

  @@index([userId])
  @@map("routers")
}

model Users {
  userId           Int          @id @unique @default(autoincrement()) @map("user_id")
  addressId        String?      @unique @map("address_id") @db.VarChar(50)
  address          Addresses?   @relation("UserAddress")
  email            String       @unique @db.VarChar(100)
  firstName        String?      @map("first_name") @db.VarChar(50)
  lastName         String?      @map("last_name") @db.VarChar(50)
  fullName         String?      @map("full_name") @db.VarChar(100)
  password         String       @db.VarChar(200)
  phone            String?      @db.VarChar(20)
  token            String?      @db.VarChar(200)
  role             Roles?       @default(USER)
  apiKey           String?      @map("api_key") @db.VarChar(200)
  refreshToken     String?      @map("refresh_token") @db.VarChar(200)
  stripeCustomerId String?      @map("stripe_customer_id") @db.VarChar(200)
  dataUsages       DataUsages[] @relation("DataUsageUser")
  routers          Routers[]    @relation("UserRouter")
  isActive         Boolean      @default(false) @map("is_active") @db.Boolean
  imageUuid        String?      @map("image_uuid") @db.VarChar(36)
  imageUrl         String?      @map("image_url") @db.VarChar(250)
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")
  deletedAt        DateTime?    @map("deleted_at")

  @@index([email], name: "user_email_key")
  @@index([addressId], name: "user_address_key")
  @@map("users")
}

model RouterLocations {
  locationId Int       @id @default(autoincrement()) @map("location_id")
  routerId   Int       @unique @map("router_id")
  longitude  Float     @map("router_logitude")
  latitude   Float     @map("router_latitude")
  dateTime   DateTime
  router     Routers   @relation(fields: [routerId], references: [routerId])
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")
  deletedAt  DateTime? @map("deleted_at")

  @@index([routerId])
  @@map("router_locations")
}

model Addresses {
  addressId    Int       @id @default(autoincrement()) @map("address_id")
  userId       Int       @unique @map("user_id")
  user         Users     @relation("UserAddress", fields: [userId], references: [userId])
  addressLine1 String    @map("address_line_1") @db.VarChar(50)
  addressLine2 String    @map("address_line_2") @db.VarChar(50)
  city         String    @db.VarChar(50)
  state        String    @db.VarChar(50)
  zip          Int
  country      String    @db.VarChar(100)
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  deletedAt    DateTime? @map("deleted_at")

  @@index([userId])
  @@map("addresses")
}
